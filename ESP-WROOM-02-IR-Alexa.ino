#include <Arduino.h>
#include <ESP8266WiFi.h>
#include "fauxmoESP.h"
#include <ESP8266mDNS.h>
#include <IRremoteESP8266.h>
#include <IRsend.h>

#define WIFI_SSID "change-ssid"
#define WIFI_PASS "change-pass"
#define SERIAL_BAUDRATE 115200
#define RELAY_PIN 12
#define IRLEDPIN 14

IRsend irsend(14);


//DAIKIN POWER ON/OFF C3（irsend.sendRawを使う場合はunsigned intをuint16_tにしてください)
unsigned int rawDataAR1OFF[583] = {488, 386,  514, 360,  510, 364,  510, 364,  510, 364,  510, 25414,  3544, 1704,  510, 1234,  510, 364,  510, 364,  510, 364,  510, 1234,  514, 360,  514, 360,  514, 360,  514, 360,  514, 1234,  514, 360,  514, 1234,  510, 1234,  514, 360,  540, 1208,  514, 1234,  510, 1238,  510, 1234,  514, 1234,  514, 360,  514, 358,  514, 1234,  488, 386,  510, 364,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 358,  516, 358,  510, 364,  510, 1240,  508, 364,  510, 1234,  514, 360,  512, 360,  514, 360,  510, 1238,  510, 1234,  514, 360,  514, 360,  514, 360,  514, 360,  514, 358,  514, 360,  510, 364,  510, 360,  514, 364,  510, 360,  514, 358,  514, 360,  514, 360,  514, 358,  510, 364,  510, 364,  508, 1236,  514, 1234,  514, 1234,  488, 386,  510, 1238,  510, 364,  510, 1234,  514, 1234,  514, 34946,  3570, 1704,  510, 1234,  514, 360,  488, 386,  510, 364,  510, 1238,  510, 364,  508, 364,  510, 360,  514, 360,  514, 1234,  488, 386,  510, 1238,  510, 1234,  514, 360,  514, 1234,  514, 1234,  514, 1234,  510, 1234,  514, 1234,  514, 360,  514, 360,  514, 1234,  488, 386,  516, 358,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  510, 364,  510, 1234,  516, 358,  514, 360,  540, 334,  514, 360,  514, 1234,  510, 364,  510, 364,  510, 364,  510, 364,  510, 358,  514, 360,  514, 360,  514, 360,  516, 358,  514, 360,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 360,  514, 360,  510, 364,  514, 1234,  510, 364,  510, 1234,  514, 358,  514, 1234,  514, 360,  488, 34998,  3564, 1682,  510, 1234,  514, 360,  510, 364,  510, 364,  510, 1234,  514, 360,  542, 332,  514, 360,  510, 364,  514, 1234,  510, 364,  510, 1234,  514, 1234,  514, 360,  514, 1234,  510, 1238,  510, 1234,  514, 1234,  488, 1262,  508, 364,  510, 364,  488, 1256,  514, 364,  510, 360,  514, 360,  514, 360,  514, 360,  514, 358,  514, 360,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 360,  488, 386,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 1236,  510, 1238,  510, 1234,  514, 360,  514, 360,  514, 360,  510, 1238,  510, 364,  510, 364,  510, 1234,  516, 1234,  514, 360,  514, 360,  514, 360,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 360,  514, 360,  510, 364,  510, 364,  510, 364,  510, 364,  510, 1234,  514, 360,  514, 1236,  508, 364,  510, 364,  510, 364,  510, 364,  510, 364,  510, 360,  514, 358,  516, 358,  514, 360,  514, 360,  488, 384,  510, 364,  510, 364,  510, 364,  510, 360,  514, 358,  516, 358,  488, 1260,  510, 1238,  536, 338,  510, 360,  514, 360,  514, 360,  488, 386,  514, 360,  488, 386,  514, 360,  510, 364,  510, 364,  510, 1234,  514, 1234,  514, 358,  514, 360,  514, 360,  510, 364,  514, 360,  510, 364,  510, 364,  510, 360,  514, 360,  514, 358,  514, 360,  510, 364,  488, 386,  510, 364,  510, 364,  510, 364,  510, 364,  510, 1234,  540, 332,  514, 360,  514, 360,  488, 386,  510, 364,  510, 1234,  514, 1234,  514, 360,  514, 360,  514, 360,  514, 360,  510, 364,  510, 364,  510, 360,  514, 1234,  514, 360,  514, 360,  514, 360,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 1234,  514, 1234,  510, 362,  510, 364,  510, 360,  514, 360,  514, 1234,  510, 1238,  510};  // DAIKIN
//unsigned int rawDataAR1OFF[583] = {510, 360,  492, 380,  492, 382,  514, 360,  488, 386,  514, 25408,  3522, 1726,  488, 1256,  514, 360,  492, 382,  514, 360,  488, 1260,  488, 384,  488, 386,  488, 386,  488, 384,  488, 1256,  514, 360,  488, 1260,  488, 1260,  488, 386,  488, 1256,  492, 1256,  492, 1256,  488, 1260,  514, 1234,  488, 386,  488, 386,  488, 1256,  492, 386,  488, 382,  488, 386,  488, 386,  488, 386,  488, 386,  488, 386,  488, 386,  488, 386,  488, 386,  508, 1236,  514, 360,  514, 1234,  514, 360,  514, 360,  514, 360,  514, 1236,  508, 1234,  540, 338,  536, 338,  536, 334,  540, 332,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  536, 338,  538, 332,  540, 334,  540, 334,  540, 1208,  542, 1202,  546, 1204,  540, 338,  536, 1208,  540, 334,  540, 1208,  540, 1204,  540, 34920,  3600, 1674,  540, 1208,  516, 358,  536, 338,  536, 338,  536, 1208,  540, 334,  540, 334,  540, 334,  540, 332,  542, 1208,  536, 338,  536, 1208,  540, 1208,  540, 332,  540, 1208,  540, 1208,  514, 1230,  540, 1208,  540, 1208,  542, 332,  540, 334,  540, 1208,  514, 360,  536, 338,  536, 338,  536, 338,  536, 334,  540, 334,  540, 332,  540, 334,  540, 334,  540, 334,  540, 334,  536, 1206,  540, 338,  536, 338,  536, 334,  540, 334,  540, 1208,  540, 334,  540, 332,  540, 334,  536, 338,  536, 338,  510, 364,  536, 338,  536, 334,  540, 334,  540, 334,  540, 334,  542, 332,  540, 334,  540, 334,  536, 338,  536, 338,  536, 338,  536, 338,  536, 334,  540, 1208,  540, 334,  540, 1208,  540, 334,  536, 1208,  540, 338,  536, 34946,  3574, 1674,  514, 1230,  540, 338,  536, 338,  536, 334,  540, 1208,  540, 334,  540, 334,  536, 338,  536, 338,  536, 1208,  540, 334,  540, 1208,  540, 1204,  540, 338,  536, 1208,  540, 1208,  540, 1208,  536, 1208,  540, 1208,  540, 334,  514, 360,  540, 1204,  540, 338,  510, 364,  510, 360,  514, 360,  540, 334,  514, 358,  540, 334,  514, 360,  536, 338,  514, 360,  514, 356,  540, 334,  540, 334,  540, 334,  540, 334,  514, 360,  536, 338,  536, 338,  536, 334,  540, 334,  540, 334,  540, 1208,  540, 1204,  544, 1204,  540, 334,  540, 334,  540, 334,  540, 1208,  540, 334,  540, 334,  536, 1208,  540, 1208,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 332,  536, 338,  536, 332,  542, 334,  540, 334,  540, 332,  540, 334,  540, 334,  540, 334,  540, 1204,  544, 334,  536, 1208,  542, 332,  540, 334,  540, 334,  540, 334,  540, 332,  540, 334,  536, 338,  536, 338,  536, 334,  540, 332,  540, 334,  540, 334,  540, 334,  540, 332,  540, 334,  536, 338,  540, 334,  536, 1208,  540, 1208,  540, 334,  540, 334,  540, 334,  540, 334,  536, 338,  536, 334,  540, 334,  540, 332,  540, 334,  540, 334,  540, 1204,  540, 1208,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 332,  536, 338,  540, 334,  536, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  536, 1208,  540, 334,  540, 334,  540, 334,  540, 334,  540, 332,  542, 1202,  544, 1204,  540, 334,  540, 334,  566, 308,  540, 334,  540, 334,  566, 308,  540, 334,  536, 1208,  540, 334,  540, 334,  540, 332,  540, 334,  540, 334,  540, 332,  540, 334,  540, 334,  536, 1208,  540, 1208,  540, 334,  540, 334,  540, 332,  540, 334,  540, 1204,  540, 1208,  540};  // DAIKIN

//DAIKIN POWER ON/OFF C4（irsend.sendRawを使う場合はunsigned intをuint16_tにしてください)
unsigned int rawDataAR1ON[583] = {510, 364,  510, 358,  514, 360,  514, 360,  514, 360,  514, 25410,  3574, 1668,  540, 1208,  540, 332,  540, 334,  542, 332,  540, 1204,  544, 334,  540, 332,  536, 338,  536, 332,  540, 1208,  540, 332,  540, 1204,  546, 1204,  540, 338,  536, 1208,  540, 1208,  540, 1204,  544, 1204,  540, 1208,  540, 334,  540, 334,  540, 1208,  540, 334,  540, 334,  536, 334,  540, 338,  536, 334,  540, 334,  540, 334,  540, 332,  542, 332,  540, 334,  540, 1204,  540, 338,  536, 1208,  540, 334,  540, 334,  540, 334,  540, 1204,  540, 1208,  540, 334,  540, 332,  540, 334,  540, 334,  540, 334,  540, 332,  542, 332,  536, 338,  536, 338,  536, 332,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  536, 1208,  540, 1208,  540, 1208,  540, 332,  540, 1204,  540, 338,  536, 1208,  540, 1208,  540, 34918,  3570, 1700,  544, 1204,  540, 338,  536, 332,  542, 332,  542, 1206,  542, 334,  540, 334,  540, 334,  540, 334,  536, 1208,  540, 334,  540, 1208,  540, 1204,  546, 334,  540, 1204,  540, 1208,  540, 1208,  540, 1204,  544, 1204,  544, 334,  536, 334,  540, 1208,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 330,  540, 334,  540, 332,  540, 332,  540, 1204,  546, 334,  540, 334,  540, 334,  536, 334,  540, 1208,  540, 334,  540, 334,  540, 334,  540, 332,  540, 334,  536, 338,  536, 338,  536, 334,  540, 332,  540, 334,  540, 334,  540, 332,  542, 332,  540, 334,  536, 338,  536, 338,  536, 334,  540, 334,  540, 334,  540, 1208,  540, 334,  540, 1204,  540, 338,  536, 1208,  540, 334,  540, 34926,  3590, 1674,  540, 1208,  540, 334,  536, 338,  540, 334,  536, 1208,  540, 334,  540, 334,  540, 332,  542, 334,  540, 1204,  540, 338,  536, 1208,  540, 1208,  540, 334,  540, 1204,  544, 1204,  540, 1208,  540, 1208,  540, 1208,  540, 334,  536, 338,  536, 1208,  542, 332,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  536, 338,  536, 334,  540, 334,  542, 332,  540, 334,  540, 334,  540, 334,  536, 338,  536, 338,  536, 332,  540, 334,  540, 1208,  540, 334,  540, 334,  540, 1204,  540, 1208,  542, 1208,  542, 332,  540, 334,  536, 338,  536, 1208,  540, 334,  540, 334,  540, 1208,  540, 1204,  544, 334,  536, 338,  536, 338,  536, 334,  540, 332,  542, 332,  540, 334,  540, 332,  542, 334,  540, 334,  536, 338,  536, 338,  536, 334,  540, 334,  540, 334,  540, 1208,  540, 334,  540, 1204,  540, 334,  540, 334,  540, 334,  542, 334,  540, 334,  540, 332,  540, 334,  540, 334,  536, 338,  536, 338,  536, 334,  540, 334,  540, 334,  540, 334,  540, 332,  540, 334,  536, 338,  536, 1208,  542, 1208,  540, 334,  540, 334,  540, 334,  540, 332,  536, 338,  536, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 1204,  540, 1208,  540, 334,  540, 334,  542, 332,  542, 334,  540, 334,  536, 338,  536, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  540, 334,  536, 338,  536, 338,  536, 334,  540, 334,  540, 1208,  540, 334,  540, 334,  536, 338,  540, 334,  536, 332,  540, 1208,  540, 1208,  540, 334,  514, 360,  536, 338,  536, 336,  536, 334,  540, 334,  540, 334,  540, 1204,  544, 334,  536, 338,  536, 338,  536, 334,  540, 334,  540, 334,  540, 332,  542, 332,  542, 332,  536, 338,  536, 1208,  540, 334,  540, 334,  540, 334,  540, 1204,  540, 1208,  540};  // DAIKIN
//unsigned int rawDataAR1ON[583] = {510, 364,  510, 360,  514, 360,  514, 358,  514, 360,  514, 25412,  3522, 1726,  508, 1236,  514, 360,  514, 360,  510, 364,  510, 1234,  514, 364,  510, 360,  514, 360,  514, 358,  514, 1234,  516, 358,  510, 1238,  514, 1230,  514, 364,  510, 1234,  514, 1234,  514, 1234,  514, 1234,  514, 1234,  510, 364,  510, 364,  510, 1234,  514, 360,  540, 332,  514, 360,  514, 360,  514, 360,  514, 360,  510, 364,  510, 364,  510, 364,  508, 364,  510, 1234,  514, 358,  514, 1234,  510, 364,  508, 364,  514, 360,  510, 1234,  514, 1234,  514, 360,  514, 360,  514, 358,  514, 360,  514, 360,  510, 364,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  540, 334,  514, 360,  514, 360,  514, 358,  510, 364,  510, 1238,  510, 1234,  514, 1236,  514, 360,  514, 1234,  488, 386,  510, 1238,  510, 1238,  510, 34950,  3568, 1730,  484, 1234,  514, 360,  514, 360,  514, 360,  514, 1234,  510, 364,  510, 364,  510, 364,  510, 364,  510, 1234,  514, 360,  514, 1234,  514, 1234,  488, 386,  514, 1234,  510, 1238,  510, 1236,  512, 1234,  514, 1234,  514, 360,  488, 386,  510, 1240,  508, 364,  510, 364,  510, 360,  514, 364,  508, 360,  516, 358,  514, 360,  514, 360,  514, 360,  514, 358,  488, 386,  510, 1240,  508, 364,  510, 364,  510, 360,  514, 364,  510, 1232,  514, 360,  514, 360,  514, 358,  514, 360,  514, 360,  514, 360,  514, 358,  514, 360,  510, 364,  488, 386,  510, 364,  510, 364,  488, 386,  510, 364,  510, 364,  510, 364,  510, 364,  536, 332,  514, 360,  514, 1234,  514, 360,  514, 1234,  514, 360,  514, 1234,  514, 360,  510, 34978,  3564, 1678,  514, 1234,  514, 360,  514, 360,  514, 360,  488, 1260,  510, 364,  510, 364,  508, 364,  510, 364,  510, 1234,  514, 360,  514, 1234,  514, 1234,  514, 360,  512, 1234,  510, 1238,  514, 1234,  514, 1230,  514, 1234,  514, 364,  510, 360,  514, 1234,  514, 360,  514, 360,  514, 358,  514, 360,  514, 360,  488, 386,  514, 360,  488, 386,  488, 386,  510, 364,  488, 386,  510, 364,  510, 364,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 1234,  514, 360,  514, 360,  514, 1234,  514, 1234,  488, 1260,  516, 358,  514, 360,  488, 384,  510, 1234,  514, 364,  510, 364,  508, 1234,  514, 1234,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 358,  514, 360,  514, 358,  514, 360,  514, 360,  514, 358,  488, 386,  514, 360,  514, 1234,  510, 364,  510, 1234,  494, 384,  510, 364,  510, 364,  510, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  514, 360,  488, 386,  488, 384,  510, 364,  488, 384,  488, 386,  510, 364,  510, 364,  510, 1234,  514, 1234,  514, 360,  514, 358,  488, 386,  514, 358,  516, 358,  514, 360,  488, 386,  488, 386,  488, 386,  488, 386,  510, 1234,  514, 1234,  488, 386,  514, 360,  514, 360,  514, 360,  488, 386,  488, 386,  488, 386,  488, 386,  488, 386,  510, 364,  510, 360,  514, 358,  488, 386,  488, 386,  514, 360,  514, 360,  488, 386,  488, 1260,  488, 386,  488, 386,  488, 386,  488, 386,  488, 382,  514, 1234,  488, 1260,  514, 360,  514, 358,  488, 386,  486, 386,  488, 386,  510, 364,  488, 386,  510, 1234,  514, 364,  490, 386,  508, 360,  488, 386,  514, 360,  514, 360,  488, 386,  516, 358,  488, 386,  488, 386,  488, 1260,  488, 386,  488, 386,  488, 386,  488, 1256,  514, 1234,  514};  // DAIKIN


//IRIS LIGHT MEMORY POWER ON（irsend.sendRawを使う場合はunsigned intをuint16_tにしてください)
unsigned int rawDataLT1ON[257] = {2076, 946,  5570, 1000,  1536, 438,  566, 438,  566, 434,  566, 438,  570, 428,  570, 434,  570, 434,  566, 438,  1588, 416,  566, 432,  566, 438,  566, 434,  570, 434,  566, 434,  548, 460,  1562, 438,  576, 428,  572, 428,  570, 432,  568, 432,  570, 434,  570, 434,  566, 436,  566, 434,  544, 460,  566, 432,  576, 428,  570, 434,  566, 434,  570, 434,  566, 438,  566, 434,  566, 440,  1564, 438,  566, 444,  1562, 442,  1536, 464,  566, 442,  1558, 450,  1558, 454,  544, 9438,  2102, 920,  5592, 980,  1532, 446,  528, 468,  566, 434,  570, 432,  566, 438,  566, 434,  570, 432,  566, 442,  1558, 442,  566, 442,  562, 432,  572, 428,  570, 434,  596, 408,  566, 438,  1562, 444,  566, 434,  570, 434,  566, 444,  526, 468,  566, 438,  566, 434,  570, 434,  544, 454,  572, 432,  566, 438,  566, 434,  566, 438,  566, 438,  566, 434,  566, 438,  566, 432,  572, 438,  1588, 412,  570, 438,  1558, 446,  1562, 438,  566, 442,  1558, 446,  1562, 452,  524, 9460,  2102, 924,  5592, 978,  1538, 436,  566, 434,  570, 434,  570, 434,  566, 434,  566, 438,  570, 428,  572, 438,  1562, 438,  570, 434,  570, 428,  572, 432,  576, 428,  566, 438,  566, 438,  1564, 440,  568, 432,  544, 460,  566, 434,  570, 434,  566, 438,  576, 424,  572, 432,  568, 432,  570, 434,  570, 430,  570, 434,  544, 460,  566, 434,  570, 434,  570, 428,  576, 428,  572, 436,  1564, 438,  570, 438,  1562, 446,  1558, 438,  572, 438,  1558, 446,  1536, 476,  550};  // UNKNOWN AA79DC16

//IRIS LIGHT POWER OFF（irsend.sendRawを使う場合はunsigned intをuint16_tにしてください)
unsigned int rawDataLT1OFF[257] = {2102, 926,  5590, 982,  1536, 432,  546, 458,  568, 432,  572, 432,  566, 434,  570, 434,  544, 458,  566, 438,  1562, 442,  566, 432,  546, 458,  566, 434,  570, 438,  1562, 438,  572, 432,  570, 430,  570, 438,  562, 438,  566, 434,  596, 408,  570, 430,  570, 434,  570, 432,  566, 434,  570, 434,  570, 428,  572, 442,  532, 464,  566, 438,  566, 432,  570, 434,  544, 456,  570, 442,  1558, 436,  572, 438,  1562, 446,  1562, 442,  1536, 468,  1562, 438,  570, 446,  548, 9436,  2132, 890,  5568, 1004,  1532, 438,  600, 402,  572, 434,  566, 434,  572, 432,  566, 438,  566, 432,  572, 438,  1558, 442,  650, 356,  574, 424,  570, 434,  566, 442,  1562, 438,  544, 460,  566, 434,  572, 432,  566, 438,  566, 434,  574, 424,  576, 430,  570, 434,  544, 456,  570, 434,  572, 432,  566, 434,  570, 434,  570, 430,  570, 434,  574, 430,  566, 432,  570, 434,  544, 464,  1558, 442,  572, 438,  1562, 442,  1536, 472,  1558, 446,  1558, 442,  566, 446,  550, 9438,  2102, 920,  5594, 978,  1532, 442,  544, 456,  570, 434,  566, 438,  536, 464,  570, 430,  570, 434,  570, 438,  1562, 438,  572, 432,  566, 432,  570, 434,  570, 442,  1562, 434,  566, 434,  570, 434,  566, 438,  570, 428,  572, 432,  544, 460,  566, 434,  570, 438,  532, 464,  570, 434,  570, 430,  570, 432,  572, 432,  570, 430,  576, 428,  566, 438,  566, 434,  570, 438,  562, 442,  1562, 438,  570, 438,  1558, 450,  1558, 442,  1562, 452,  1562, 432,  566, 446,  550};  // UNKNOWN EC890164

//SONY TV　POWER ON/OFF（irsend.sendRawを使う場合はunsigned intをuint16_tにしてください)
unsigned int rawDataTV1[103] = {2464, 516,  1272, 520,  670, 520,  1266, 520,  650, 542,  1272, 542,  676, 516,  674, 516,  1272, 516,  676, 520,  670, 520,  672, 520,  670, 25566,  2464, 514,  1272, 520,  670, 520,  1266, 520,  670, 520,  1270, 542,  676, 516,  672, 520,  1272, 516,  676, 516,  676, 520,  648, 542,  672, 25570,  2464, 520,  1268, 520,  650, 542,  1272, 516,  674, 520,  1266, 542,  674, 520,  670, 520,  1244, 542,  670, 520,  648, 542,  674, 516,  674, 25580,  2438, 542,  1270, 516,  676, 516,  1272, 520,  670, 520,  1266, 520,  696, 494,  696, 494,  1296, 516,  754, 438,  674, 520,  670, 520,  648};  // SONY A90


fauxmoESP fauxmo;
//制御するスイッチの数にあわせて調整
bool roomswitch[4]= {false, false, false, false};

void wifiSetup() {

    // Set WIFI module to STA mode
    WiFi.mode(WIFI_STA);

    // Connect
    Serial.printf("[WIFI] Connecting to %s ", WIFI_SSID);
    WiFi.begin(WIFI_SSID, WIFI_PASS);

    // Wait
    while (WiFi.status() != WL_CONNECTED) {
        Serial.print(".");
        delay(100);
    }

    Serial.println();

    // Connected!
    Serial.printf("[WIFI] STATION Mode, SSID: %s, IP address: %s\n", WiFi.SSID().c_str(), WiFi.localIP().toString().c_str());
}

void callbackSetState(unsigned char device_id, const char * device_name, bool state){
   Serial.printf("[MAIN] Device #%d (%s) state: %s\n", device_id, device_name, state ? "ON" : "OFF");
   roomswitch[device_id] = state;

  //もう少しかっこいいフローにしたかったんですが・・・コールバックでオンかオフが見えているようだったので、
  //デバイスIDとオンコールかオフコールかの条件をみて実行するようにしています。
  if ((device_id == 0)&&(roomswitch[device_id] == true)) {
        //irsend.sendRaw(rawDataAR1ON, 583, 38);
        sendIRData(rawDataAR1ON, 583);
        Serial.println("Call:Living Aircon ON");
        delay(1000);
  }
  if ((device_id == 0)&&(roomswitch[device_id] == false)) {
        //irsend.sendRaw(rawDataAR1OFF, 583, 38);
        sendIRData(rawDataAR1OFF, 583);
        Serial.println("Call:Living Aircon OFF");
        delay(1000);
  }
  if ((device_id == 1)&&(roomswitch[device_id] == true)) {
        //irsend.sendRaw(rawDataLT1ON, 257, 38);
        sendIRData(rawDataLT1ON, 257);
        Serial.println("Call:Living Light ON");
        delay(1000);
  }
  if ((device_id == 1)&&(roomswitch[device_id] == false)) {
        //irsend.sendRaw(rawDataLT1OFF, 257, 38);
        sendIRData(rawDataLT1OFF, 257);
        Serial.println("Call:Living Light OFF");
        delay(1000);
  }
   if ( device_id == 2) {
        //irsend.sendRaw(rawDataTV1, 103, 38);
        sendIRData(rawDataTV1, 103);
        Serial.println("Call:Living TV");
        delay(1000);
  }
}

bool callbackGetState(unsigned char device_id, const char * device_name){
  return roomswitch[device_id];
}

void setup() {

  // Serial
  Serial.begin(SERIAL_BAUDRATE);
  Serial.println();
  Serial.println();

  // Wifi
  wifiSetup();
  irsend.begin();
  delay(10);

  fauxmo.enable(true);

  //ここでデバイスネームを決めます。Alexaアプリ側で日本語に書き換えればOKっす
  fauxmo.addDevice("Living Aircon");
  fauxmo.addDevice("Living Light");
  fauxmo.addDevice("Living TV");

  // Calback
  fauxmo.onSetState(callbackSetState);
  fauxmo.onGetState(callbackGetState);
}


void loop() {
  fauxmo.handle();
}

//SWITCHSCIENCE様の赤外線送信フローをそのまま流用
void sendIRData(unsigned int  *data, int dataSize)
{
  unsigned int i=0,power=HIGH;

  digitalWrite(IRLEDPIN, LOW);

  while(i < dataSize)
  {
    if(power == HIGH)
    {
      long startedTime = micros();
      while(micros() - startedTime < data[i])
      {
        digitalWrite(IRLEDPIN, HIGH);
        delayMicroseconds(8);
        digitalWrite(IRLEDPIN, LOW);
        delayMicroseconds(13);
      }

      power = LOW;
    }else{
      digitalWrite(IRLEDPIN, LOW);
      delayMicroseconds(data[i]);
      power = HIGH;
    }
    i++;
  }

  digitalWrite(IRLEDPIN, LOW);

}
